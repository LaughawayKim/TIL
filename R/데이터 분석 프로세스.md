# 4. 데이터 분석 프로세스

## 4.1. 기본 용어

### 4.1.1. 기초통계(descriptive statistics)

데이터에 대한 통계적 자료분석에 앞서 데이터의 대략적인 통계적 수치를 계산해 봄으로써 데이터에 대한 대략적인 이해와 앞으로 진행될 분석에 대한 insight 얻기 위한 분석방법

### 4.1.2. 변수(variable)

수집된 자료에서 관심의 대상이 되는 특성이나 관측된 결과로서 주어지는 특성

### 4.1.3. 변수의 유형

- 질적변수(Qualitative Variable) 또는 범주형 변수(Categorial Variable)

  - 특성을 범주로 구분해서 나타내는 변수
  - 성별구분(남자:1 , 여자 :2) ,  소득수준 (상, 중, 하)

- 양적변수(Quantative Variable)

  - 연속형 변수(continuous Variable)
  - 이산형 변수(Discrete Variable)
  - 관심대상이 되는 특성을 수치로 나타내는 변수
  - 몸무게, 키, 환자의 나이

- 독립변수

  다른 변수에 영향을 주는 변수 (원인변수, 설명변수, 예측변수)

- 종속변수

  - 다른 변수에 영향을 받는 변수 (결과변수, 피설명변수, 피예측변수)
  - '흡연은 폐암을 유발한다'에서  흡연은 독립변수, 폐암은 종속변수

- 자료의 형태에 따른 분류

  | 구분          | 설명                                                         |
  | ------------- | ------------------------------------------------------------ |
  | 명목척도 자료 | 단지 구분하기 위한 부호로 표현된 자료(성별, 혈액형, 주거형태, 학과) |
  | 서열척도 자료 | 관측되는 개체들에 순서를 갖는 자료 (학년, 선호도, 신용등급)  |
  | 구간척도 자료 | 관측 값의 순서와 순서사이의   간경이   의미가 있는 자료 (성적,   온도 등) |
  | 비율척도 자료 | 두 간격(차이)에   대한 비율이 의미를 갖는 자료(연령,   시간,   거리) |

## 4.2. 분석 절차와 통계지식

### 4.2.1. 빅데이터 분석













```R
# 표본오차 구하기
20세 이상 유권자 1,500명 대상으로 A 후보 대선 출마에 대한 찬성과 반대를 조사하는 설문조사를 시행하였다. 설문조사 결과 95% 신뢰수준에서 찬성이 55%, 반대가 45%가 나왔다. 이때 표본오차는?

Z = 1.96
N = 1500
찬성률 p = 55% = 0.55
반대율 1-p = 45% = 0.45

0.025176656
0.025176656

```

- aslkdfjals;kdjf



## 4.3. Quiz

```R
Q1> 다음 중 가설이 갖추어야 할 요건이 아닌 것은? 4
① 가설은 경험적으로 검증할 수 있어야 한다.
② 가설은 계량적인 형태를 취하든가 계량화 할 수 있어야 한다.
③ 가설의 표현은 간단명료해야 한다.
④ 가설은 동일 분야의 다른 가설과 연관을 가져서는 안된다.

Q2> 다음 중 과학적 연구절차에 기초한 올바른 이론 구축 과정은? 1
① 연구문제 - 개념화 - 가설검정 - 자료수집- 자료분석
② 개념화-연구문제-가설검정- 자료수집- 자료분석
③ 연구문제 -가설검정 -개념화 - 자료수집- 자료분석
④ 개념화 -가설검정 -연구문제 -자료수집- 자료분석

Q3> 가설 검정에 관한 설명으로 옳은 것은? 1
① 검정 통계량은 확률변수이다.
② 대립가설은 사전에 알고 있는 값이다.
③ 유의수준 α를 작게 할수록 좋은 검정법이다.
④ 가설이 틀렸을 때 틀렸다고 판정할 확률을 유의수준이라 한다. 

Q4> '남녀 월급액수에는 차이가 있다'라는 주장을 검증하기 위하여 사회조사를 시행하였다.
조사결과 남자집단의 평균액수는 μ1, 여자집단의 μ2라고 한다면, 귀무가설은? 2
①  μ1 > μ2
②  μ1 = μ2
③  μ1 < μ2
④  μ1 ≠ μ2

Q5> 가설구성 시 고려할 사항이 아닌 것은? 4
① 경험적 검증이 가능하여야 한다.
② 다른 가설 및 이론과의 연관성을 가져야 한다.
③ 두 개 이상의 변수 간의 관계로 서술되어야 한다.
④ 한 가설에 독립변수나 종속변수 수가 많아지도록 한다.

Q6> 가설의 특성이라고 할 수 없는 것은? 4
① 문제를 해결해 줄 수 있어야 한다. 
② 변수로 구성되며, 그들 간의 관계를 나타내고 있어야 하낟.
③ 검증될 수 있어야 한다.
④ 매개변수가 있어야 한다.

Q7> 유의확률(p-value)의 설명이 틀린 것은? 2
①  검정 통계량이 실제 관측된 값보다 대립가설을 지지하는 방항으로 더욱 치우칠 확률로서 귀무가설 하에서 계산된 값이다
② 주어진 데이터와는 직접적으로 관계가 없다.
③ 유의확률이 낮을 수록 반증이 강한 것을 뜻한다.
④ 귀무가설에 대한 반증의 강도에 대하여 기준값을 미리 정해놓고 p-value값을 그 기준값과 비교한다.

Q8> 다음 내용에 대한 가설형태로 옳은 것은? 2
기존의 진통제는 진통효과가 지속되는 시간이 평균 30분이고, 표준편차는 5분이라고 한다. 
새로운 진통제를 개발하였는데, 개발팀은 이 진통제의 진통 효과가 30분 이상이라고 주장한다.
① H0 : μ<30, H1: μ=30
② H0 : μ=30, H1: μ>30
③ H0 : μ>30, H1: μ=30
④ H0 : μ=30, H1: μ≠30

Q9> 모집단의 회귀계수β에 대한 표본 회귀계수가 0.23일 경우, 독립변수가 종속변수에 의미 있는
영향을 미치는지를 알기 위해 모집단 회귀계수에 대한 가설 검정을 하려고 할 떄 귀무가설과 대립가설은? 1
① H0 : β= 0, H1: β≠ 0
② H0 : β≠ 0, H1: β= 0
③ H0 : β= 0.23, H1: β≠ 0.23
④ H0 : β≠ 0.23, H1: β= 0.23

11> 통계적 검증 오류중 제 1종 오류에 해당하는 것은? 1
① 귀무가설이 참임에도 불구하고 이를 기각
② 귀무가설이 참이므로 이를 채택
③ 귀무가설이 거짓이므로 채택
④ 귀무가설이 거짓임에도 이를 기각

12> 통계적 가설의 기각 여부를 판정하는 가설 검정에 대한 설명으로 맞는 것은? 4
① 표본으로부터 확실한 근거에 의하여 입증하고자 하는 가설을 귀무가설이라 한다.
② 유의수준은 제2종 오류를 범할 확률의 최대허용한계이다.
③ 대립가설을 채택하게 하는 검정 통계량의 영역을 채택역이라 한다.
④ 대립가설이 옳은데도 귀무가설을 채택함으로써 범하게 되는 오류를 제2종 오류라 한다.

13> 통계적 가설 검정을 위한 검정 통계값에 대한 유의확률(p-value)이 주어졌을 때, 귀무가설을 유의수준 α 로 기각할 수 있는 경우는? 2
① p-value >  α
② p-value <  α
③ p-value =  α
④ p-value >  2α

14> 정규분포의 특성에 대한 설명으로 틀린 것은? 2
① 평균, 중위수, 최빈수가 모두 일치한다.
② X=μ에 관해 종 모양의 좌우대칭이고, 이 점에서 확률 밀도함수가 최대값 1/0을 갖는다.
③ 분포의 기울어진 방향과 정도를 나타내는 지표는 왜도이다.
④ 분포의 봉우리가 얼마나 뾰족한가를 나타내는 지표 첨도이다.

15> 보험가입액의 모평균이 1억 원이라고 볼 수 있는가를 검정하고자 한다. 이에 대한 t-검정 통계량이 1.201이고, 유의확률이 0.239이었다. 
① '유의확률 > 유의수준'이므로 모평균이 1억 원이라는 가설을 기각하지 못한다.
② '유의확률 > 유의수준'이므로 모평균이 1억 원이라는 가설을 기각한다.
③ '검정 통계량 1.201 >유의수준'이므로 모평균이 1억 원이라는 가설을 기각하지 못한다.
④ '검정 통계량 1.201 >유의수준'이므로 모평균이 1억 원이라는 가설을 기각한다.

16> '표본의 크기가 충분히 크다면, 표본의 평규은 0에 가까워진다.'는 이론은?
중심극한정리(The central limit theorem)

Q17> 표준화 변환을 하면 변환된 자료의 평균과 표준편차의 값은? 1
① 평균 = 0, 표준편차 = 1
② 평균 = 1, 표준편차 = 1
③ 평균 = 1, 표준편차 = 0
④ 평균 = 0, 표준편차 = 0

Q18> 신뢰수준에 대한 설명으로 틀린 것은? 4
① 신뢰구간에 확신하는 정도를 의미한다.
② 신뢰수준은 연구자가 결정한다.
③ 신뢰수준이 95%라는 의미는 표본오차가 ±5%라는 의미이다.
④ 신뢰수준 높이면 신뢰구간은 넓어진다. -> (좁아진다)

Q19> A회사에서 만든 제품의 수명의 표준편차는 50이라고 한다. 새로운 공정
에 의해 제품 100개를 생산하여 실험한 결과 수명의 평균이 280이었다.
모 평균에 대한 95% 오차 한계는? 1
①  9.8
②  12.9
③   98
④  129

Q20> 크기가 n표본으로 신뢰수준 95%를 갖도록 모평균을 추정하였더니 
신뢰구간의 길이가 10이었다. 동일한 조건 아래 표본의 크기만을 1/4로 줄이면
신뢰구간의 길이는? 3
①  1/4로 줄어든다
②  1/2로 줄어든다
③  2배로 늘어난다.
④  4배로 늘어난다.

Q21> 어느 고등학교 1학년 1,000명의 성적분포가 평균 80점, 표준편차 20점인 정규분포로 나타났다.
이경우에 60점 이상 100점 이하의 점수를 얻은 학생은 대략 몇 명인가? 2
①  350
②  680
③  790
④  850
```

## 4.4. 기술 통계 분석

- 기술통계량

  ```R
  data <- read.csv("./data/descriptive.csv", header=T)
  
  # resident - 거주지역
  # gender - 성별(명목 1, 2)
  # age - 연령
  # level - 학력수준(서열 1, 2, 3)
  # cost - 생활비(비율)
  # type - 학교유형(명목 1, 2)
  # survey - 만족도(등간척도 5점)
  # pass - 합격여부(명목 1, 2)
  
  dim(data)
  [1] 300   8
  
  length(data) # 변수 개수(열)
  length(data$servey) # 관측치 개수(행)
  
  fivenum(data) # minimum, lower-hinge, median, upper-hinge, maximum
  summary(data) # 컬럼 단위로 최솟값, 최댓값, 평균, 1and3분위수, 결측치, 중앙값(중위수) 등
  
  
  # 명목척도의 기술 통계량(결측치제거 > 빈도수 > 비율 > 백분율)
  length(data$gender) # 관측치 확인
  summary(dat$gender) # 명목척도는 최솟값, 최댓값, 평균 등 의미가 없음
  # 각 성별의 빈도수
  tabel(data$gender)
  # 결측치 제거 후 시각화
  data <- subset(data, data$gender == 1 | data$gender == 2)
  x <- table(data$gender) # 빈도수에 따른 분할표
  barplot(x)
  # 비율 계산
  y <- prop.table(x)
  # 백분율로 변환
  round(y*100, 2)
  
  
  # 서열척도의 기술 통계량
  summary(data$level) # 서열척도도 최솟값, 최댓값, 평균 등 의미없음 -> ???
  x1 <- table(data$level)
  barplot(x1)
  y1 <- prop.table(x1)
  round(y1 * 100, 2)
  barplot(y1)
  
  
  # 등간척도의 기술 통계량
  survey <- data$survey
  summary(survey) # 등간척도에서 평균 통계량은 어느 정도 의미가 있다.
     Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NAs 
     1.00    2.00    3.00    2.61    3.00    5.00     113
  x2 <- table(survey) # 빈도수는 의미 있음
  hist(survey) #등간척도 시각화(히스토그램)
  pie(x2) #빈도수를 이용한 시각화 - 파이 차트
  
  
  # 비율척도의 기술 통계량
  length(data$cost)
  summary(data$cost) # 요약 통계 - 의미 있음
  plot(data$cost)	# 이상치 발견
  boxplot(data$cost) # 이상치 발견
  data2 <- subset(data, data$cost >= 2 & data$cost <= 10)
  x3 <- data2$cost
  mean(x3); median(x3) # 평균이 극단치에 영향을 받는 경우 중위수로 대체하는 것이 더 효과적
  # 예
  A반 성적 = 75, 80, 80, 80, 85 	평균:80 중위수:80
  B반 성적 = 75, 75, 75, 75, 100 평균:80 중위수:75
  # 사분위값
  quantile(x3, 1/4) # 1사분위 수
  quantile(x3, 2/4) # 중앙값과 동일
  quantile(x3, 3/4) #
  quantile(x3, 4/4)
  # 최빈수 - 빈도수가 가장 많은 변량
  x3.t <- table(x3)
  x.max <- sort(x.t, decreasing=T)[1]
  as.numeric(names(x.max)[1])
  # 다른방법
  x3.m <- rbind(x3.t)
  x3.df <- as.data.frame3.m)
  x3.df
  which(x3.df[1,]==18) # 특정 값을 지닌 인덱스를 알려줌
  [1] 25
  names(x3.df[25])
  
  
  # 산포도는 분산과 표준편차를 통계량으로 사용
  
  
  # 비율척도의 빈도 분석 : 비율척도를 범주화(리코딩)
  table(data$cost)
  hist(data$cost)
  plot(data$cost)
  
  
  # 연속형(비율척도) 변수 범주화
  data$cost2[data$cost >=1 & data$cost<=3] <- 1
  data$cost2[data$cost >=4 & data$cost<=6] <- 2
  data$cost2[data$cost >=7 ] <- 3
  table(data$cost2)
  barplot(table(data$cost2))
  pie(table(data$cost2))
  
  
  # 정규분포를 갖는 지 확인 - 왜도, 첨도
  install.packages("moments")
  library(moments)
  cost <- data$cost[!is.na(data$cost)]
  skewness(cost) # 왜도 반환 0보다 크면, 0보다 작으면...
  [1] 2.486237
  hist(cost)
  hist(cost, freq=F) # 히스토그램의 계급을 확률 밀도로 표현
  lines(density(cost), col="blue") #cost의 밀도 분포 곡선
  x <- seq(0, 8, 0.1) # 0~8 범위의 0.1씩 증가하는 데이터 벡터 생성
  curve(dnorm(x, mean(cost), sd(cost)), col='red', add=T)
  
  # attach() /detach()
  #리스트객체$key, dataframe객체$컬럼변수
  #attach()함수는 dataframe객체$컬럼변수로부터  dataframe객체 데이터셋 이름을 생략하고 컬럼변수만으로 관측치에 사용가능
  #detach()함수는  dataframe객체$컬럼변수로 관측치에 접근
  data <- read.csv("./data/descriptive.csv", header=T)
  # 원래 접근 방식
  length(data$survey)
  summary(data$cost)
  # attach 접근 방식
  attach(data)
  length(survey)
  summary(cost)
  # detach
  detach(data)
  length(survey) #오류
  summary(cost) #오류
  
  
  # Hmisc 패키지
  install.packages("Hmisc")
  library(Hmisc)
  describe(data)
  
  # prettyR 패키지
  install.packages("prettyR")
  library(prettyR)
  freq(data)
  
  # Quiz> 거주지역 변수 리코딩 후 비율 계산
  # 1은 특별시, 2~4는 광역시, 5는 시군구
  # 빈도수, 비율, 백분율
  resident <- data$resident[!is.na(data$resident)]
  resident[resident == 1] <- "특별시"
  resident[2 <= resident & resident <= 4 ] <- "광역시"
  resident[resident == 5] <- "시군구"
  freq(resident)
  
  # Quiz> 성별 변수 리코딩 후 비율 계산
  # 범주화 : 1은 남자, 2는 여자
  # 빈도수, 비율, 백분율
  gender <- data$gender[data$gender == 1 | data$gender == 2]
  gender[gender == 1] <- "남자"
  gender[gender == 2] <- "여자"
  freq(gender)
  
  # Quiz> 나이변수 리코딩 후 비율 계산
  # 범주화 : <= 45 중년층, 46~69 장년층, >=60 노년층
  # 빈도수, 비율, 백분율
  age <- data$age[!is.na(data$age)]
  age[age <= 45] <- 1 #문자열로 바꾸니 자동형변환 때문에 귀찮은 일이 생겨서 숫자로
  age[46 <= age & age <= 69] <- 2
  age[age >= 70] <- 3
  freq(age)
  
  ```

- 표본추출

  ```R
  # 샘플링
  # 80대 20
  # 과적합 (분리하지 않고...)
  
  # 단순 임의 추출
  sample(1:10, 5, replace = T) #복원 추출
  sample(1:10, 5) #비복원 추출
  # 가중치 사용시 prob 파라미처 사용
  
  
  # 층화 임의 추출
  sampling::ska.....
  install.packages("sampling")
  library(sampling)
  head(iris)
  result <- strata(c("Species"), size=c(3, 3, 3), method="srswor", data=iris)
  # srswor: 비복원 단순 임의 추출
  # srswr : 복원 단순 임의 추출
  # poisson : 포아송 추출
  # systematic : 계통 추출
  
  # 계통 추출
  install.packages("doBy")
  library(doBy)
  x <- data.frame(x=1:10)
      x
  1   1
  2   2
  3   3
  4   4
  5   5
  6   6
  7   7
  8   8
  9   9
  10 10
  sampleBy(~1, frac=0.3, data=x, systematic=T)
    [,1] [,2] [,3]
  1    1    4    7
  
  
  # 분할표Contingency Table
  table(c("a", "b", "b", "b", "c", "c", "d"))
  d <- data.frame(x=c("1", "2", "2", "1"),  y=c("A", "B", "A", "B"),   num=c(3, 5, 8, 7))
    x y num
  1 1 A   3
  2 2 B   5
  3 2 A   8
  4 1 B   7
  xtabs(num ~ x + y, data=d)
     y
  x   A B
    1 3 7
    2 8 5
  d2 <- data.frame(x=c("A", "A", "A", "B", "B"))
  xtabs(~ x, d2)
  x
  A B 
  3 2 
  # margin.table 주변?
  xt <- xtabs(num ~ x + y, data = d)
     y
  x   A B
    1 3 7
    2 8 5
  margin.table(xt, 1) #행
  x
   1  2 
  10 13 
  margin.table(xt, 2) #열
  y
   A  B 
  11 12 
  margin.table(xt) # 전체
  [1] 23
  # prop.table : 분할표에 대해서 각각의 비율을 반환해 주는 함수
  prop.table(xt, 1)
     y
  x           A         B
    1 0.3000000 0.7000000
    2 0.6153846 0.3846154
  prop.table(xt, 2)  #  3/11, 7/12
                        8/11, 5/12
  
  prop.table(xt)     #  3/23, 7/23
                        8/23, 5/23
  
  
  ```

- 교차 분석

  ```R
  #교차분석을 위한 변수 모델링
  data <- read.csv("./data/cleanDescriptive.csv", header=TRUE)
  data
  str(data)
  
  #부모의 학력 수준이 자녀의 대학 진학 여부와 관련이 있는지를 분석하기
  # 학력수준 변수는 독립변수
  # 대학진학 여부 변수는 종속변수
  x <- data$level2
  y <- data$pass2
  result <- data.frame(Level=x, Pass=y)
  dim(result)
  
  #교차분석을 위한
  table(result)
            Pass
  Level      실패 합격
    고졸       40   49
    대졸       27   55
    대학원졸   23   31
  
  install.packages("gmodels")
  library(gmodels)
  library(ggplot2)
  CrossTable(result$Level, result$Pass)
     Cell Contents
  |-------------------------|
  |                       N |
  | Chi-square contribution |
  |           N / Row Total |
  |           N / Col Total |
  |         N / Table Total |
  |-------------------------|
  
   
  Total Observations in Table:  225 
  
   
               | result$Pass 
  result$Level |      실패 |      합격 | Row Total | 
  -------------|-----------|-----------|-----------|
          고졸 |        40 |        49 |        89 |  # 관측치
               |     0.544 |     0.363 |           |  # 카이제곱
               |     0.449 |     0.551 |     0.396 | # 행비율
               |     0.444 |     0.363 |           | # 열비율
               |     0.178 |     0.218 |           | # 전체비율
  -------------|-----------|-----------|-----------|
          대졸 |        27 |        55 |        82 | 
               |     1.026 |     0.684 |           | 
               |     0.329 |     0.671 |     0.364 | 
               |     0.300 |     0.407 |           | 
               |     0.120 |     0.244 |           | 
  -------------|-----------|-----------|-----------|
      대학원졸 |        23 |        31 |        54 | 
               |     0.091 |     0.060 |           | 
               |     0.426 |     0.574 |     0.240 | 
               |     0.256 |     0.230 |           | 
               |     0.102 |     0.138 |           | 
  -------------|-----------|-----------|-----------|
  Column Total |        90 |       135 |       225 | 
               |     0.400 |     0.600 |           | 
  -------------|-----------|-----------|-----------|
  
  # 5만4천개의 다이아몬드 속성 데이터 셋
  # price, carat, cut(커팅품질), color, clarity(선명도:명목)
  CrossTable(x=diamonds$color, y=diamonds$cut)
  
  
  ## 이원 카이제곱 검정(독립성 검증)
  # 부모의 학력수준과 자녀의 진학여부와 관련성이 있는지 독립성 검정
  연구가설(H0): 부모의 학력수준과 자녀의 진학여부는 관련성 없다.
  대립가슬(H1): 부모의 학력수준과 자녀의 진학여부는 관련성이 있다.
  
  # 부모의 학력 수준이 자녀의 대학진학 여부와 관련이 있는지를 분석하기 위
  x <- data$level2
  y <- data$pass2
  result <- data.frame(Level=x, Pass=y)
  CrossTable(result$Level, result$Pass)
  
  chisq.test(x=result$Level, y=result$Pass) #이부분이 중요!!!!!!!!
  
  	Pearson''s Chi-squared test
  
  data:  result$Level and result$Pass
  X-squared = 2.767, df = 2, p-value = 0.2507
  
  해석:
  유의확률(p-value) 0.2507 이 유의수준(α= 0.05) 보다 크므로 귀무가설 채택
  부모의 학력수준과 자녀의 진학여부와 관련성이 없다
  
  카이제곱 검정통계랑 : 2.767, 자유도 : 2
  임계값 : 5.99, 기각값(X^2 >= 5.99) 이면 귀무가설을 기각할 수 있다. -> 그런데 위 예에서는 못해
  
  
  # 일원 카이제곱 검정
  # 일치하는지를 검정하는 적합도 검정(test for goodness of fit)과 선호도 분석에서 주로 이용된다.
  귀무가설: 기대치와 관찰치는 차이가 없다. 예) 스포츠음료에 대한 선호도가 없다.
  대립가설: 기대치와 관찰치는 차이가 있다. 예) 스포츠음료에 대한 선호도가 있다.
  
  data <- textConnection("스포츠음료종류	관측도수
  	1	41
  	2	30
  	3	51
  	4	71
  	5	61
  ")
  x <- read.table(data, header=T)
  chisq.test(x$관측도수)
  data:  x$관측도수
  X-squared = 20.488, df = 4, p-value = 0.0003999
  
  해석: 유의확률(p-value) 0.0003999 이 유의수준(0.05) 보다 작으므로 귀모가설을 기각할 수 있고 연구가설 채택 됨(스포츠음료에 대한 선호도에 차이가 있다).
  카이제곱검정통계량이 20.488이 9.49(검정표값)보다 크므로 귀모가설을 기각할 수 있다.
  
  
  
  # 동질성 검정: 이원 카이제곱검정 중 하나. 두 집단의 분포가 동일한지.
  data <- read.csv("./data/homogenity.csv", header=T)
  head(data)
  str(data)
  #method 방법 1, 2, 3
  #survey 만족도 1:매우만족 ~ 5:매우 불만족
  
  귀무가설(H0): 교육방법에 따라 만족도 차이가 없다.
  대립가설(H1): 교육방법에 따라 만족도 차이가 있다.
  
  data <- subset(data, !is.na(survey), c(method, survey))
  data$method2[data$method==1] <- "방법1"
  data$method2[data$method==2] <- "방법2"
  data$method2[data$method==3] <- "방법3"
  data$survey2[data$survey==1] <- "매우만족"
  data$survey2[data$survey==2] <- "만족"
  data$survey2[data$survey==3] <- "보통"
  data$survey2[data$survey==4] <- "불만족"
  data$survey2[data$survey==5] <- "매우불만족"
  
  table(data$method2, data$survey2) #table(행, 열)
         
          만족 매우만족 매우불만족 보통 불만족
    방법1    8        5          6   15     16 #= 50
    방법2   14        8          6   11     11 #= 50
    방법3    7        8          9   11     15 #= 50
  # 방법1, 방법2, 방법3의 관측치의 개수는 50으로 동일 -> 반드시 각 집단의 개수는 동일해야한다
  # 동질성 검정
  chisq.test(data$method2, data$survey2)
  
  	Pearson''s Chi-squared test
  
  data:  data$method2 and data$survey2
  X-squared = 6.5447, df = 8, p-value = 0.5865
  
  해석:
  유의확률 0.5865가 유의수준(0.05)보다 크므로 귀무가설을 기각할 수 없다. 연구가설(대립가설) 채택
  카이제곱검정값 6.5447이 15.51(검정표값)보다 작으므로 귀무가설을 기각할 수 없다. 연구가설(대립가설) 채택
  
  ############### 실습 연습문제#############################################
  ###Quiz01>
   교육수준(education)과 흡연율(smoking) 간의 관련성을 분석하기 위한 연구가설을 수
  립하고, 각 단계별로 가설을 검정하시오. [독립성 검정]
  귀무가설(H0) : "교육수준과 흡연율은 관련이 없다." 
  연구가설(H1) : "교육수준과 흡연율은 관련이 있다."
   
  smoke <- read.csv("./data/smoke.csv", header=TRUE)
  head(smoke)
  
  education : 1:대졸, 2:고졸, 3:중졸
  smoke : 1:과다흡연, 2:보통흡연, 3:비흡연
  smoke$edu[smoke$education == 1] <- "대졸"
  smoke$edu[smoke$education == 2] <- "고졸"
  smoke$edu[smoke$education == 3] <- "중졸"
  smoke$smk[smoke$smoking == 1] <- "과다흡연" 
  smoke$smk[smoke$smoking == 2] <- "보통흡연" 
  smoke$smk[smoke$smoking == 3] <- "비흡연" 
  
  chisq.test(smoke$edu, smoke$smk)
  
  	Pearson''s Chi-squared test
  
  data:  smoke$edu and smoke$smk
  X-squared = 18.911, df = 4, p-value = 0.0008183
  
  해석:
  유의확률 0.0008183이 유의수준(0.05)보다 작으므로 귀무가설을 기각할 수 있다. 연구가설 채택
  카이제곱검정값 18.911이 9.49(검정표값) 보다 키므로 귀무가설을 기각할 수 있다. 연구가설 채택
  -> 관련 있다.
  
  
  ###Quiz02>
  나이(age3)와 직위(position) 간의 관련성을 단계별로 분석하시오. [독립성 검정]
  
  귀무가설(H0) : "나이와 직위 간에는 관련성이 없다."
  연구가설(H1) : "나이와 직위 간에는 관련성이 있다."
   
  data <- read.csv("./data/cleanData.csv", header=TRUE)
  head(data)
  
  data.sub <- subset(data, !is.na(position), c(age3, position))
  chisq.test(data.sub$age3, data.sub$position)
  
  	Pearson''s Chi-squared test
  
  data:  data.sub$age3 and data.sub$position
  X-squared = 287.9, df = 8, p-value < 2.2e-16 
  
  해석:
  유의확률 2.2e-16이 유의수준(0.05)보다 작으므로 귀무가설을 기각할 수 있다. 연구가설 채택
  카이제곱검장값 287.9가 15.51(검정표값)보다 크므로 귀무가설을 기각할 수 있다. 연구가설 채택.
  -> 관련 있다.
  
  
  ###Quiz03>
  직업유형에 따른 응답정도에 차이가 있는가를 단계별로 검정하시오.[동질성 검정]
  
  귀무가설(H0) : "직업유형에 따라 응답정도에 차이가 없다."
  연구가설(H1) : "직업유형에 따라 응답정도에 차이가 있다."
   
  response <- read.csv("./data/response.csv", header=TRUE)
  head(response) 
  
  job : 1:학생, 2:직장인, 3:주부
  response : 1:무응답, 2:낮음, 3:높음
  
  response$job2[response$job == 1] <- "학생"
  response$job2[response$job == 2] <- "직장인"
  response$job2[response$job == 3] <- "주부"
  response$res2[response$response == 1] <- "무응답"
  response$res2[response$response == 2] <- "낮음"
  response$res2[response$response == 3] <- "높음"
  
  chisq.test(response$job2, response$res2)
  
  	Pearson''s Chi-squared test
  
  data:  response$job2 and response$res2
  X-squared = 58.208, df = 4, p-value = 6.901e-12
  
  해석:
  유의확률(5.901e-12)이 유의수준(0.05)보다 작으므로 귀무가설을 기각할 수 있다. 연구가설 채택.
  카이제곱검정값(58.208)이 검정표값(9.49)보다 크므로 귀무가설을 기각할 수 있다. 연구가설 채택.
  -> 관련 있다.
  
  ```

  ![1568788262542](assets/1568788262542.png)

- 피셔의 정확 검정

  ```R
  #표본 수가 적거나 표본이 분할표의 셀에 매우 치우치게 분포되어 있다면 카이 제곱 검정의 결과가 부정확할 수 있다.
  fisher.test(
      x, # 행렬 형태의 이차원 분할표 또는 팩터
      y = NULL, # 팩터, x가 행렬이면 무시된다.
      alternative="two.sided" #대립가설로 two.sided 양측 검정, less는 작다, greater는 크다
  )
  
  MASS::survey #데이터에서 손글씨를 어느 손으로 쓰는지와 박수를 칠 때 어느 손이 위로 가는지 사이의 경우에 대해 피셔의 정확 검정을 수행
  
  귀무가설 : "손글씨 손과 박수 칠 때 위로 가는 손은 관련이 없다."
  연구가설 : "손글씨 손과 박수 칠 때 위로 가는 손은 관련이 있다."
  survey <- MASS::survey
  
  xtabs(~ W.Hnd + Clap, data=survey)
         Clap
  W.Hnd   Left Neither Right
    Left     9       5     4
    Right   29      45   143
  
  ##
  chisq.test(xtabs(~ W.Hnd + Clap, data=survey))
  
  	Pearson''s Chi-squared test
  
  data:  xtabs(~W.Hnd + Clap, data = survey)
  X-squared = 19.252, df = 2, p-value = 6.598e-05
  
  Warning message:
  In chisq.test(xtabs(~W.Hnd + Clap, data = survey)) :
    카이제곱 approximation은 정확하지 않을수도 있습니다
  
  ##
  fisher.test(xtabs(~ W.Hnd + Clap, data=survey))
  
  	Fisher''s Exact Test for Count Data
  
  data:  xtabs(~W.Hnd + Clap, data = survey)
  p-value = 0.0001413
  alternative hypothesis: two.sided
  ```

- 맥니마 검정

  ```R
  # 벌금을 부과하기 시작한 후 안전벨트 착용자의 수, 선거 유세를 하고 난 뒤 지지율의 변화와 같이 응답자의 성향이 사건 전후에 어떻게 달라지는지를 알아보는 경우
  # 사건 전후에 설문 결과에 응답자 수 변화가 없다면 Test1의 positive와 Test2의 positive가 동일해야...
  
  # 투표권이 있는 나이의 미국인 1,600명에 대해 대통령 지지율을 조사
  # 1차 조사 와 2차 조사 한 달 간격으로 수행
  # Argresti (1990), p.350.
  # Presidenttial Approval Ratings.
  # Approval of the President's performance in office in two
  # surveys, one month apart, for a random sample of 1600
  # voting-age Americans
  
  Performance <- matrix(
      c(794, 86, 150, 570),
      nrow = 2,
      dimnames = list (
          "1st Survey" = c("Approve", "Disapprove"),
          "2st Survey" = c("Approve", "Disapprove")
      )
  )
  
  Performance
  mcnemar.test(Performance)
  ```

  